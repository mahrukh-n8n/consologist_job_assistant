---
phase: 01-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - manifest.json
  - src/background/service-worker.js
  - src/content/upwork-content.js
  - src/popup/popup.html
  - src/popup/popup.js
  - src/utils/.gitkeep
  - icons/icon16.svg
  - icons/icon48.svg
  - icons/icon128.svg
autonomous: true

must_haves:
  truths:
    - "Extension loads in Chrome without errors (chrome://extensions shows no warnings)"
    - "Service worker registers successfully (DevTools shows no SW registration failure)"
    - "Content script injects on upwork.com pages without console errors"
    - "Popup opens without errors when clicking the extension icon"
    - "All required permissions are declared (storage, notifications, downloads, activeTab)"
  artifacts:
    - path: "manifest.json"
      provides: "Extension entry point, permissions, component declarations"
      contains: "manifest_version: 3"
    - path: "src/background/service-worker.js"
      provides: "Persistent event listener shell for future alarms and webhook dispatch"
    - path: "src/content/upwork-content.js"
      provides: "Content script shell for DOM scraping on upwork.com"
    - path: "src/popup/popup.html"
      provides: "Settings UI entry point"
    - path: "src/popup/popup.js"
      provides: "Popup logic shell"
  key_links:
    - from: "manifest.json"
      to: "src/background/service-worker.js"
      via: "background.service_worker field"
      pattern: "\"service_worker\": \"src/background/service-worker.js\""
    - from: "manifest.json"
      to: "src/content/upwork-content.js"
      via: "content_scripts[0].js array"
      pattern: "\"js\": \\[\"src/content/upwork-content.js\"\\]"
    - from: "manifest.json"
      to: "src/popup/popup.html"
      via: "action.default_popup field"
      pattern: "\"default_popup\": \"src/popup/popup.html\""
---

<objective>
Create the installable Chrome extension scaffold: folder structure, manifest, and empty shells for all three components (service worker, content script, popup).

Purpose: Without this scaffold, nothing else in the project can be tested. Chrome must accept the extension before any feature work can begin.
Output: A loadable unpacked extension at the project root. No features — just structural correctness.
</objective>

<execution_context>
@C:/Users/Glorvax/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/Glorvax/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
Global pattern references (adapt from Python to JavaScript):
- NotificationManager safe-fail pattern → will be adapted in later phases using chrome.notifications API
- WebhookUtility retry/backoff pattern → will be adapted in later phases using fetch API
- EnvironmentAdapter message passing → adapted here as chrome.runtime.sendMessage / onMessage pattern stubs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create folder structure and manifest.json</name>
  <files>
    manifest.json
    src/background/.gitkeep
    src/content/.gitkeep
    src/popup/.gitkeep
    src/utils/.gitkeep
    icons/.gitkeep
  </files>
  <action>
    Create the following directory tree at the project root (C:\Users\Glorvax\Documents\upwork chrome extention\):

      src/
        background/
        content/
        popup/
        utils/
      icons/

    Then create manifest.json at the project root with this exact content:

    ```json
    {
      "manifest_version": 3,
      "name": "Upwork Job Scraper",
      "version": "0.1.0",
      "description": "Scrapes Upwork job listings and pushes to n8n webhooks on a schedule.",

      "permissions": [
        "activeTab",
        "storage",
        "notifications",
        "downloads",
        "alarms"
      ],

      "host_permissions": [
        "*://*.upwork.com/*"
      ],

      "background": {
        "service_worker": "src/background/service-worker.js",
        "type": "module"
      },

      "content_scripts": [
        {
          "matches": ["*://*.upwork.com/*"],
          "js": ["src/content/upwork-content.js"],
          "run_at": "document_idle"
        }
      ],

      "action": {
        "default_popup": "src/popup/popup.html",
        "default_icon": {
          "16": "icons/icon16.svg",
          "48": "icons/icon48.svg",
          "128": "icons/icon128.svg"
        },
        "default_title": "Upwork Job Scraper"
      },

      "icons": {
        "16": "icons/icon16.svg",
        "48": "icons/icon48.svg",
        "128": "icons/icon128.svg"
      }
    }
    ```

    Note: "alarms" permission is included now (not listed in original spec but required for schedule interval feature in Phase 2 — avoids a manifest update mid-project).
    Note: "type": "module" on service_worker enables ES module imports in the SW, which will be needed when src/utils/ helpers are imported.
  </action>
  <verify>JSON is valid: `node -e "JSON.parse(require('fs').readFileSync('manifest.json','utf8')); console.log('valid')"` from project root.</verify>
  <done>manifest.json exists at project root, JSON is valid, all five permission strings present, host_permissions covers upwork.com, all three component paths declared.</done>
</task>

<task type="auto">
  <name>Task 2: Create component shells and placeholder icons</name>
  <files>
    src/background/service-worker.js
    src/content/upwork-content.js
    src/popup/popup.html
    src/popup/popup.js
    icons/icon16.svg
    icons/icon48.svg
    icons/icon128.svg
  </files>
  <action>
    Create each file with the minimum viable shell content shown below.

    --- src/background/service-worker.js ---
    ```javascript
    // Upwork Job Scraper — Service Worker (MV3)
    // Handles: scheduled alarms, webhook dispatch, cross-component messaging
    // Adapts: WebhookUtility retry/backoff pattern (global class) via fetch API
    // Adapts: EnvironmentAdapter message-passing pattern via chrome.runtime.onMessage

    console.log('[SW] Upwork Job Scraper service worker started');

    // Install / activate lifecycle
    self.addEventListener('install', () => {
      console.log('[SW] Installed');
    });

    self.addEventListener('activate', () => {
      console.log('[SW] Activated');
    });

    // Message router — shell for Phase 2 handlers
    chrome.runtime.onMessage.addListener((message, sender, sendResponse) => {
      console.log('[SW] Message received:', message.type);
      // Handlers added in later phases
      return false; // synchronous response (no async yet)
    });

    // Alarm listener — shell for Phase 2 scheduled scraping
    chrome.alarms.onAlarm.addListener((alarm) => {
      console.log('[SW] Alarm fired:', alarm.name);
      // Scrape handler added in Phase 2
    });
    ```

    --- src/content/upwork-content.js ---
    ```javascript
    // Upwork Job Scraper — Content Script
    // Runs on: *://*.upwork.com/*
    // Handles: DOM scraping, job data extraction
    // Communicates with: service worker via chrome.runtime.sendMessage

    console.log('[Content] Upwork Job Scraper content script loaded on:', window.location.href);

    // Message listener from popup or service worker
    chrome.runtime.onMessage.addListener((message, sender, sendResponse) => {
      console.log('[Content] Message received:', message.type);

      if (message.type === 'PING') {
        sendResponse({ status: 'ok', url: window.location.href });
        return true;
      }

      return false;
    });
    ```

    --- src/popup/popup.html ---
    ```html
    <!DOCTYPE html>
    <html lang="en">
    <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Upwork Job Scraper</title>
      <link rel="stylesheet" href="popup.css">
    </head>
    <body>
      <div id="app">
        <h1>Upwork Job Scraper</h1>
        <p>Settings UI — Phase 1 shell</p>
      </div>
      <script src="popup.js"></script>
    </body>
    </html>
    ```

    --- src/popup/popup.js ---
    ```javascript
    // Upwork Job Scraper — Popup Script
    // Handles: settings load/save, UI event binding
    // Storage: chrome.storage.local (all settings persisted here)

    document.addEventListener('DOMContentLoaded', () => {
      console.log('[Popup] Settings UI loaded');
      // Settings form binding added in Plan 01-02
    });
    ```

    --- icons/icon16.svg ---
    ```svg
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16">
      <rect width="16" height="16" rx="3" fill="#1d4354"/>
      <text x="8" y="12" font-size="10" font-family="sans-serif" fill="#14a800" text-anchor="middle">U</text>
    </svg>
    ```

    --- icons/icon48.svg ---
    ```svg
    <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 48 48">
      <rect width="48" height="48" rx="8" fill="#1d4354"/>
      <text x="24" y="34" font-size="28" font-family="sans-serif" fill="#14a800" text-anchor="middle">U</text>
    </svg>
    ```

    --- icons/icon128.svg ---
    ```svg
    <svg xmlns="http://www.w3.org/2000/svg" width="128" height="128" viewBox="0 0 128 128">
      <rect width="128" height="128" rx="16" fill="#1d4354"/>
      <text x="64" y="92" font-size="80" font-family="sans-serif" fill="#14a800" text-anchor="middle">U</text>
    </svg>
    ```

    Color rationale: #1d4354 (Upwork dark teal background), #14a800 (Upwork brand green "U" letter). SVG icons work as placeholder because Chrome accepts SVG in manifest action.default_icon.
  </action>
  <verify>
    1. All seven files exist: `ls src/background/service-worker.js src/content/upwork-content.js src/popup/popup.html src/popup/popup.js icons/icon16.svg icons/icon48.svg icons/icon128.svg`
    2. Load as unpacked extension: Open chrome://extensions, enable Developer Mode, click "Load unpacked", select the project root folder. Extension card should appear with no error badge.
  </verify>
  <done>
    Extension loads in chrome://extensions with no red error badge. Service worker shows "active" status. Clicking the extension icon opens a popup showing "Upwork Job Scraper — Settings UI — Phase 1 shell".
  </done>
</task>

</tasks>

<verification>
Load the unpacked extension in Chrome:
1. Navigate to chrome://extensions
2. Enable "Developer mode" (top-right toggle)
3. Click "Load unpacked" and select the project root directory
4. Extension card appears: name "Upwork Job Scraper", version "0.1.0"
5. No red error badge on the card
6. Click "service worker" link — DevTools shows "[SW] Upwork Job Scraper service worker started"
7. Click extension icon — popup opens showing "Upwork Job Scraper" heading
8. Navigate to upwork.com — browser console shows "[Content] Upwork Job Scraper content script loaded on: https://..."
</verification>

<success_criteria>
- manifest.json is valid MV3 JSON with all required permissions
- Extension loads without errors in Chrome
- Service worker registers and logs startup message
- Content script injects on upwork.com and logs its URL
- Popup opens from extension icon click
- File count: 12 files created (1 manifest + 3 component files + 3 icons + 5 empty-dir placeholders)
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-01-SUMMARY.md` following the summary template.
Key facts to capture: manifest permissions list, file paths for all three components, icon color scheme, that "alarms" was added proactively.
</output>
